---
title: "mge_qbs181_midterm"
author: "Mengdie Ge"
date: "10/29/2019"
output: pdf_document
---
--------------------------------------
1.    The DIQ_I.xpt(will be uploaded on canvas) file has some problems with its data (e.g., missing values, numeric columns stored as chars, etc.) and need to be cleaned before further use. 

A. List the data-related issues you see in this dataset:

(1) there are so many missing values in the dataset. The missing values are also set as 'NA' instead of NULL. 
(2) besides missing values, there are unknown and refused to answer data, which are indicated by 777, 999, 77, 99, etc., which will affect future use.
(3) there are also duplicated columns that the one is the time period, the other is the units of the time-period such as year, month, week and days;
(4) the dataset is very hard to read since all of the labels of the columns are codes rather than the actual questions. If anyone needs to understand the dataset, they should read the online table of codes as well.
(5) different categorical data has different meanings. Not all categorical data means yes or no but other meanings.

-------------------------------------
B. How will you address each data-related issue?

(1) I counted the missing values when I compared the counts of the dataset to the website information to help me decide if I need to replace or drop the missing values. I changed all the columns nullable so the NA would be changed into NVARCHAR NULL. However, maybe because of R, the changed is not showed clearly if we call VIEW(dataset). Its change from NA to NULL in SQL is very clearly.

(2) For the unknown and refused answering data, I counted them at first to see if there were any bad affections after I dealt with them. For numerical data, if there is a small number of unknown and refused to answer data, I used mean or median to replace them, which depends on the specific problems, and I wrote more details below in the R chunks to explain how to deal with them and the reasons for every column. Otherwise, I did not leave them on the dataset. I changed them into missing values since they would provide little useful info for future modeling. For the categorical data, I changed the unknown and refused to answer data into missing values because either fill them or drop them will affect the future use if the dataset is used to create a classifier or logistic model.

(3) I changed the unit columns in the same single unit, and then changed the time period column equal to (its original time period times units). It would also useful for future use because the values among the columns are with the same units. 

(4) I relabeled every column with the actual question of the column and tried to make the meanings of the columns more clearly.

(5) I added new columns for the categorical columns with specific meanings rather than just yes or no. I also renamed these columns to make them more clearly and easier to read.

--------------------------------------
C. Give justification for why you chose a particular way to address each issue. For example, if you decide to address missing values by removing rows or filling empty data cells, justify your decision or if you want to create a PHI field like the year of Birth

(1) I found that there are too many missing values to either drop them or use mean or median to fill. If I drop the missing values on each column, I have to drop the respondent's other info as well. Then the dataset will lose so many useful info just because, in the specific column, there are missing values. Because there are so many missing values, if I fit the missing value by other statistics, the distribution of a variable (column) will change, which will affect the future modeling and create lots of biases.

(2) For numerical data, if there is a small number of unknown and refused to answer data, I used mean to replace them because I believe that the distribution of the column would not change. I added more specific reasons for the R chunk.


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library("RODBC")
library(dplyr)
myconn <- odbcConnect("qbs181","mge","mge@qbs181")
```

Alter table and make the column nullable.
```{r}
#copy origin table into a new table called DIQ_copy
DIQ_copy <- sqlQuery(myconn,"drop table mge.DIQ_copy 
                     select * into mge.DIQ_copy from mge.DIQ_I_version1;")

#alter table
update_table <- sqlQuery(myconn, "alter table mge.DIQ_copy
alter column did040 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq160 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq170 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq172 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175a NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175b NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175c NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175d NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175e NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175f NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175g NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175h NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175i NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175j NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175k NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175l NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175m NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175n NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175O NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175p NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175q NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175r NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175s NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175t NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175u NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175v NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175w NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175x NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq180 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq050 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column did060 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq060u NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq070 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq230 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq240 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column did250 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column DID260 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq260u NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq275 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq280 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq291 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq300s NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq300d NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column did310s NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column did310d NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column did320 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column did330 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column did341 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column did350 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq350u NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq360 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq080 NVARCHAR(50) NULL;")
```

```{r}
#change all NA to null
deal_withNA <- sqlQuery(myconn, "update mge.DIQ_copy set did040 = NULL
where did040 = 'NA'
update mge.DIQ_copy set diq160 = NULL
where diq160 = 'NA'
update mge.DIQ_copy set diq170 = NULL
where diq170 = 'NA'
update mge.DIQ_copy set diq172 = NULL
where diq172 = 'NA'
update mge.DIQ_copy set diq175a = NULL
where diq175a = 'NA'
update mge.DIQ_copy set diq175b = NULL
where diq175b = 'NA'

update mge.DIQ_copy set diq175c = NULL
where diq175c = 'NA'

update mge.DIQ_copy set diq175d = NULL
where diq175d = 'NA'

update mge.DIQ_copy set diq175e = NULL
where diq175e = 'NA'

update mge.DIQ_copy set diq175f = NULL
where diq175f = 'NA'

update mge.DIQ_copy set diq175g = NULL
where diq175g = 'NA'

update mge.DIQ_copy set diq175h = NULL
where diq175h = 'NA'

update mge.DIQ_copy set diq175i = NULL
where diq175i = 'NA'

update mge.DIQ_copy set diq175j = NULL
where diq175j = 'NA'

update mge.DIQ_copy set diq175k = NULL
where diq175k = 'NA'

update mge.DIQ_copy set diq175l = NULL
where diq175l = 'NA'

update mge.DIQ_copy set diq175m = NULL
where diq175m = 'NA'

update mge.DIQ_copy set diq175n = NULL
where diq175n = 'NA'

update mge.DIQ_copy set diq175o = NULL
where diq175o = 'NA'

update mge.DIQ_copy set diq175p = NULL
where diq175p = 'NA'

update mge.DIQ_copy set diq175q = NULL
where diq175q = 'NA'

update mge.DIQ_copy set diq175r = NULL
where diq175r = 'NA'

update mge.DIQ_copy set diq175s = NULL
where diq175s = 'NA'

update mge.DIQ_copy set diq175t = NULL
where diq175t = 'NA'

update mge.DIQ_copy set diq175u = NULL
where diq175u = 'NA'

update mge.DIQ_copy set diq175v = NULL
where diq175v = 'NA'

update mge.DIQ_copy set diq175w = NULL
where diq175w = 'NA'

update mge.DIQ_copy set diq175x = NULL
where diq175x = 'NA'

update mge.DIQ_copy set diq180 = NULL
where diq180 = 'NA'

update mge.DIQ_copy set diq050 = NULL
where diq050 = 'NA'

update mge.DIQ_copy set did060 = NULL
where did060  = 'NA'

update mge.DIQ_copy set diq060u = NULL
where diq060u = 'NA'

update mge.DIQ_copy set diq070 = NULL
where diq070 = 'NA'

update mge.DIQ_copy set diq230 = NULL
where diq230 = 'NA'

update mge.DIQ_copy set diq240 = NULL
where diq240 = 'NA'

update mge.DIQ_copy set did250 = NULL
where did250 = 'NA'

update mge.DIQ_copy set did260 = NULL
where did260 = 'NA'

update mge.DIQ_copy set diq260u = NULL
where diq260u = 'NA'

update mge.DIQ_copy set diq275 = NULL
where diq275 = 'NA'

update mge.DIQ_copy set diq280 = NULL
where diq280 = 'NA'

update mge.DIQ_copy set diq291 = NULL
where diq291 = 'NA'

update mge.DIQ_copy set diq300s = NULL
where diq300s = 'NA'

update mge.DIQ_copy set diq300d = NULL
where diq300d = 'NA'

update mge.DIQ_copy set did310s = NULL
where did310s = 'NA'

update mge.DIQ_copy set did310d = NULL
where did310d = 'NA'

update mge.DIQ_copy set did320 = NULL
where did320 = 'NA'

update mge.DIQ_copy set did330 = NULL
where did330 = 'NA'

update mge.DIQ_copy set did341 = NULL
where did341 = 'NA'

update mge.DIQ_copy set did350 = NULL
where did350 = 'NA'

update mge.DIQ_copy set diq350u = NULL
where diq350u  = 'NA'

update mge.DIQ_copy set diq360 = NULL
where diq360 = 'NA'

update mge.DIQ_copy set diq080 = NULL
where diq080 = 'NA';")

result_show <- sqlQuery(myconn, "select * FROM mge.DIQ_copy")

head(result_show, n=10)
```

```{r}
#Verify the counts of each code or value for various variables
#diq010
(verfication_diq010_1 <- sqlQuery(myconn, "select COUNT(diq010) from mge.DIQ_copy
where diq010 = '1';"))

(verfication_diq010_2 <- sqlQuery(myconn, "select COUNT(diq010) from mge.DIQ_copy
where diq010 = '2';"))

(verfication_diq010_3 <- sqlQuery(myconn, "select COUNT(diq010) from mge.DIQ_copy
where diq010 = '3';"))

(verfication_diq010_7 <- sqlQuery(myconn, "select COUNT(diq010) from mge.DIQ_copy
where diq010 = '7';"))

(verfication_diq010_9 <- sqlQuery(myconn, "select COUNT(diq010) from mge.DIQ_copy
where diq010 = '9';"))

(verfication_diq010<-sqlQuery(myconn,"
select COUNT(*)-COUNT(diq010) from mge.DIQ_copy;
"))
```

```{r}
#did040
(verfication_did040_2to78 <- sqlQuery(myconn, "select COUNT(did040) from mge.DIQ_copy
where did040 between '2' and '78';"))

(verfication_did040_80 <- sqlQuery(myconn, "
select COUNT(did040) from mge.DIQ_copy
where did040 = '80;'"))

(verfication_did040_666 <- sqlQuery(myconn, "
select COUNT(did040) from mge.DIQ_copy
where did040 = '666';"))

(verfication_did040_777 <- sqlQuery(myconn, "
select COUNT(did040) from mge.DIQ_copy
where did040 = '777';"))

(verfication_did040_999 <- sqlQuery(myconn, "
select COUNT(did040) from mge.DIQ_copy
where did040 = '999';"))

(verfication_did040 <- sqlQuery(myconn, "
select COUNT(*)-COUNT(did040) from mge.DIQ_copy;"))
```

```{r}
#diq160
(verfication_diq160_1 <- sqlQuery(myconn, "select COUNT(diq160) from mge.DIQ_copy
where diq160 = '1';"))

(verfication_diq160_2 <- sqlQuery(myconn, "select COUNT(diq160) from mge.DIQ_copy
where diq160 = '2';"))

(verfication_diq160_7 <- sqlQuery(myconn, "select COUNT(diq160) from mge.DIQ_copy
where diq160 = '7';"))

(verfication_diq160_9 <- sqlQuery(myconn, "select COUNT(diq160) from mge.DIQ_copy
where diq160 = '9';"))

(verfication_diq160 <- sqlQuery(myconn, "
select COUNT(*)-COUNT(diq160) from mge.DIQ_copy;"))
```

```{r}
#diq170
(verfication_diq170_1 <- sqlQuery(myconn,"select COUNT(diq170) from mge.DIQ_copy
where diq170 = '1';"))

(verfication_diq170_2 <- sqlQuery(myconn,"select COUNT(diq170) from mge.DIQ_copy
where diq170 = '2';"))

(verfication_diq170_7 <- sqlQuery(myconn,"select COUNT(diq170) from mge.DIQ_copy
where diq170 = '7';"))

(verfication_diq170_9 <- sqlQuery(myconn,"select COUNT(diq170) from mge.DIQ_copy
where diq170 = '9';"))

(verfication_diq170 <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq170) from mge.DIQ_copy;"))
```


```{r}
#diq172
(verfication_diq172_1 <- sqlQuery(myconn,"select COUNT(diq172) from mge.DIQ_copy
where diq172 = '1';"))

(verfication_diq172_2 <- sqlQuery(myconn,"select COUNT(diq172) from mge.DIQ_copy
where diq172 = '2';"))

(verfication_diq172_7 <- sqlQuery(myconn,"select COUNT(diq172) from mge.DIQ_copy
where diq172 = '7';"))

(
verfication_diq172_9 <- sqlQuery(myconn,"select COUNT(diq172) from mge.DIQ_copy
where diq172 = '9';"))

(verfication_diq172 <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq172) from mge.DIQ_copy;"))
```

```{r}
#diq175a
(verfication_diq175a_10 <- sqlQuery(myconn,"select COUNT(diq175a) from mge.DIQ_copy
where diq175a = '10';")
)
(verfication_diq175a_77 <- sqlQuery(myconn,"select COUNT(diq175a) from mge.DIQ_copy
where diq175a = '77';"))

(verfication_diq175a_99 <- sqlQuery(myconn,"select COUNT(diq175a) from mge.DIQ_copy
where diq175a = '99';"))

(verfication_diq175a <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq175a) from mge.DIQ_copy;"))

```

```{r}
#diq175b
(verfication_diq175b_11 <- sqlQuery(myconn,"select COUNT(diq175b) from mge.DIQ_copy
where diq175b = '11';"))

(verfication_diq175b <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq175b) from mge.DIQ_copy;"))
```

```{r}
#diq175c
(verfication_diq175c_12 <- sqlQuery(myconn,"select COUNT(diq175c) from mge.DIQ_copy
where diq175c = '12';"))

(verfication_diq175c <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq175c) from mge.DIQ_copy;"))
```

```{r}
##diq175d
(verfication_diq175d_13 <- sqlQuery(myconn,"select COUNT(diq175d) from mge.DIQ_copy
where diq175d = '13';")
)
(verfication_diq175d <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq175d) from mge.DIQ_copy;"))
```

```{r}
#diq175e
(verfication_diq175e_14 <- sqlQuery(myconn,"
select COUNT(diq175e) from mge.DIQ_copy
where diq175e = '14';"))

(verfication_diq175e <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq175e) from mge.DIQ_copy;"))
```

```{r}
#diq175f
(verfication_diq175f_15 <- sqlQuery(myconn,"
select COUNT(diq175f) from mge.DIQ_copy
where diq175f = '15';"))

(verfication_diq175f <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq175f) from mge.DIQ_copy;"))
```

```{r}
#diq175f
(verfication_diq175f_16 <- sqlQuery(myconn,"
select COUNT(diq175g) from mge.DIQ_copy
where diq175g = '16';"))

(verfication_diq175f <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq175g) from mge.DIQ_copy;"))
```

```{r}
#diq175h
(verfication_diq175h_17 <- sqlQuery(myconn,"
select COUNT(diq175h) from mge.DIQ_copy
where diq175h = '17';"))

(verfication_diq175h <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq175h) from mge.DIQ_copy;"))
```

#diq175i
```{r}
(verfication_diq175i_18 <- sqlQuery(myconn,"
select COUNT(diq175i) from mge.DIQ_copy
where diq175i = '18';"))

(verfication_diq175i <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq175i) from mge.DIQ_copy;"))
```

```{r}
#diq175j
(verfication_diq175j_19 <- sqlQuery(myconn,"
select COUNT(diq175j) from mge.DIQ_copy
where diq175j = '19';"))

(verfication_diq175j <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq175j) from mge.DIQ_copy;"))
```

```{r}
#diq175k
(verfication_diq175k_20 <- sqlQuery(myconn,"
select COUNT(diq175k) from mge.DIQ_copy
where diq175k = '20';"))

(verfication_diq175k <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq175k) from mge.DIQ_copy;"))
```

```{r}
#diq175l
(verfication_diq175l_21 <- sqlQuery(myconn,"
select COUNT(diq175l) from mge.DIQ_copy
where diq175l = '21';"))

(verfication_diq175l <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq175l) from mge.DIQ_copy;"))
```


```{r}
#diq175m
(verfication_diq175m_22 <- sqlQuery(myconn,"
select COUNT(diq175m) from mge.DIQ_copy
where diq175m = '22';"))

(verfication_diq175m <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq175m) from mge.DIQ_copy;"))
```

```{r}
#diq175n
(verfication_diq175n_23 <- sqlQuery(myconn,"
select COUNT(diq175n) from mge.DIQ_copy
where diq175n = '23';")
)
(verfication_diq175n <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq175n) from mge.DIQ_copy;"))
```

```{r}
#diq175o
(verfication_diq175o_24 <- sqlQuery(myconn,"
select COUNT(diq175o) from mge.DIQ_copy
where diq175o = '24';"))

(verfication_diq175o <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq175O) from mge.DIQ_copy;"))
```

```{r}
#diq175p
(verfication_diq175p_25 <- sqlQuery(myconn,"
select COUNT(diq175p) from mge.DIQ_copy
where diq175p = '25';"))

(verfication_diq175p <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq175p) from mge.DIQ_copy;"))
```

```{r}
#diq175q

(verfication_diq175q_26 <- sqlQuery(myconn,"
select COUNT(diq175q) from mge.DIQ_copy
where diq175q = '26';"))

(verfication_diq175q <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq175q) from mge.DIQ_copy;"))
```

```{r}
#diq175r
(verfication_diq175r_27 <- sqlQuery(myconn,"
select COUNT(diq175r) from mge.DIQ_copy
where diq175r = '27';"))
(verfication_diq175r <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq175r) from mge.DIQ_copy;"))
```

```{r}
#diq175s
(verfication_diq175s_28 <- sqlQuery(myconn,"
select COUNT(diq175s) from mge.DIQ_copy
where diq175s = '28';"))

(verfication_diq175s <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq175s) from mge.DIQ_copy;"))
```

```{r}
#diq175t 
(verfication_diq175t_29 <- sqlQuery(myconn,"
select COUNT(diq175t) from mge.DIQ_copy
where diq175t = '29';")
)

(verfication_diq175t <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq175t) from mge.DIQ_copy;"))
```

```{r}
#diq175u
(verfication_diq175u_30 <- sqlQuery(myconn,"
select COUNT(diq175u) from mge.DIQ_copy
where diq175u = '30';"))

(verfication_diq175u <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq175u) from mge.DIQ_copy;"))
```

```{r}
#diq175v
(verfication_diq175v_31 <- sqlQuery(myconn,"
select COUNT(diq175v) from mge.DIQ_copy
where diq175v = '31';"))

(verfication_diq175v <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq175v) from mge.DIQ_copy;"))
```

```{r}
#diq175w
(verfication_diq175w_32 <- sqlQuery(myconn,"
select COUNT(diq175w) from mge.DIQ_copy
where diq175w = '32';"))
(verfication_diq175w <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq175w) from mge.DIQ_copy;"))
```

```{r}
#diq175x
(verfication_diq175x_33 <- sqlQuery(myconn,"
select COUNT(diq175x) from mge.DIQ_copy
where diq175x = '33';"))

(verfication_diq175x <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq175x) from mge.DIQ_copy;"))
```

```{r}
#diq180
(verfication_diq180_1 <- sqlQuery(myconn,"
select COUNT(diq180) from mge.DIQ_copy
where diq180 = '1';"))

(verfication_diq180_2 <- sqlQuery(myconn,"
select COUNT(diq180) from mge.DIQ_copy
where diq180 = '2';"))

(verfication_diq180_7 <- sqlQuery(myconn,"
select COUNT(diq180) from mge.DIQ_copy
where diq180 = '7';"))

(verfication_diq180_9 <- sqlQuery(myconn,"
select COUNT(diq180) from mge.DIQ_copy
where diq180 = '9';"))

(verfication_diq180 <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq180) from mge.DIQ_copy;"))
```

```{r}
#diq050
(verfication_diq050_1 <- sqlQuery(myconn,"
select COUNT(diq050) from mge.DIQ_copy
where diq050 = '1';"))

(verfication_diq050_2 <- sqlQuery(myconn,"
select COUNT(diq050) from mge.DIQ_copy
where diq050 = '2';"))

(verfication_diq050_7 <- sqlQuery(myconn,"
select COUNT(diq050) from mge.DIQ_copy
where diq050 = '7';"))

(verfication_diq050_9 <- sqlQuery(myconn,"
select COUNT(diq050) from mge.DIQ_copy
where diq050 = '9';"))

(verfication_diq050 <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq050) from mge.DIQ_copy;"))
```

```{r}
#diq060
(verfication_diq060_1to55 <- sqlQuery(myconn,"
select COUNT(did060) from mge.DIQ_copy
where did060 between '1' and '55';"))

(verfication_diq060_666 <- sqlQuery(myconn,"
select COUNT(did060) from mge.DIQ_copy
where did060 = '666';"))

(verfication_diq060_777 <- sqlQuery(myconn,"
select COUNT(did060) from mge.DIQ_copy
where did060 = '777';"))

(verfication_diq060_999 <- sqlQuery(myconn,"
select COUNT(did060) from mge.DIQ_copy
where did060 = '999';"))

(verfication_diq060 <- sqlQuery(myconn,"
select COUNT(*)-COUNT(did060) from mge.DIQ_copy;"))
```


```{r}
#diq060u
(verfication_diq060u_1 <- sqlQuery(myconn,"
select COUNT(diq060u) from mge.DIQ_copy
where diq060u = '1';"))

(verfication_diq060u_2 <- sqlQuery(myconn,"
select COUNT(diq060u) from mge.DIQ_copy
where diq060u = '2';"))

(verfication_diq060u <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq060u) from mge.DIQ_copy;"))
```


```{r}
#diq070
(verfication_diq070_1 <- sqlQuery(myconn,"
select COUNT(diq070) from mge.DIQ_copy
where diq070 = '1';"))

(verfication_diq070_2 <- sqlQuery(myconn,"
select COUNT(diq070) from mge.DIQ_copy
where diq070 = '2';"))

(verfication_diq070_7 <- sqlQuery(myconn,"
select COUNT(diq070) from mge.DIQ_copy
where diq070 = '7';"))

(verfication_diq070_9 <- sqlQuery(myconn,"
select COUNT(diq070) from mge.DIQ_copy
where diq070 = '9';"))


(verfication_diq070 <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq070) from mge.DIQ_copy;"))
```

```{r}
#diq230
(verfication_diq230_1 <- sqlQuery(myconn,"
select COUNT(diq230) from mge.DIQ_copy
where diq230 = '1';"))

(verfication_diq230_2 <- sqlQuery(myconn,"
select COUNT(diq230) from mge.DIQ_copy
where diq230 = '2';"))

(verfication_diq230_3 <- sqlQuery(myconn,"
select COUNT(diq230) from mge.DIQ_copy
where diq230 = '3';"))

(verfication_diq230_3 <- sqlQuery(myconn,"
select COUNT(diq230) from mge.DIQ_copy
where diq230 = '4';"))

(verfication_diq230_5 <- sqlQuery(myconn,"
select COUNT(diq230) from mge.DIQ_copy
where diq230 = '5';"))

(verfication_diq230_7 <- sqlQuery(myconn,"
select COUNT(diq230) from mge.DIQ_copy
where diq230 = '7';"))

(verfication_diq230_9 <- sqlQuery(myconn,"
select COUNT(diq230) from mge.DIQ_copy
where diq230 = '9';"))

(verfication_diq230 <- sqlQuery(myconn,"
select COUNT(*)-COUNT(diq230) from mge.DIQ_copy;"))
```

```{r}
#diq291
(verfication_diq291_1 <- sqlQuery(myconn,"
select COUNT(diq291) from mge.DIQ_copy
where diq291 = 1;"))

(verfication_diq291_2 <- sqlQuery(myconn,"
select COUNT(diq291) from mge.DIQ_copy
where diq291 = 2;"))

(verfication_diq291_3 <- sqlQuery(myconn,"
select COUNT(diq291) from mge.DIQ_copy
where diq291 = 3;"))

(verfication_diq291_4 <- sqlQuery(myconn,"
select COUNT(diq291) from mge.DIQ_copy
where diq291 = 4;"))

(verfication_diq291_5 <- sqlQuery(myconn,"
select COUNT(diq291) from mge.DIQ_copy
where diq291 = 5;"))

(verfication_diq291_6 <- sqlQuery(myconn,"
select COUNT(diq291) from mge.DIQ_copy
where diq291 = 6;"))

(verfication_diq291_77 <- sqlQuery(myconn,"
select COUNT(diq291) from mge.DIQ_copy
where diq291 = 77;"))

(verfication_diq291_99 <- sqlQuery(myconn,"
select COUNT(diq291) from mge.DIQ_copy
where diq291 = 99;"))

(verfication_diq291 <- sqlQuery(myconn,"
select COUNT(*) - COUNT(diq291) from mge.DIQ_copy;"))
```

```{r}
#diq360
(verfication_diq360_1 <- sqlQuery(myconn,"
select COUNT(diq360) from mge.DIQ_copy
where diq360= 1;"))

(verfication_diq360_2 <- sqlQuery(myconn,"
select COUNT(diq360) from mge.DIQ_copy
where diq360= 2;"))

(verfication_diq360_3 <- sqlQuery(myconn,"
select COUNT(diq360) from mge.DIQ_copy
where diq360= 3;"))

(verfication_diq360_4 <- sqlQuery(myconn,"
select COUNT(diq360) from mge.DIQ_copy
where diq360= 4;"))

(verfication_diq360_5 <- sqlQuery(myconn,"
select COUNT(diq360) from mge.DIQ_copy
where diq360= 5;"))

(verfication_diq360_7 <- sqlQuery(myconn,"
select COUNT(diq360) from mge.DIQ_copy
where diq360= 7;"))

(verfication_diq360_9 <- sqlQuery(myconn,"
select COUNT(diq360) from mge.DIQ_copy
where diq360= 9;"))

(verfication_diq360 <- sqlQuery(myconn,"
select COUNT(*) - COUNT(diq360) from mge.DIQ_copy;"))
```

```{r}
#diq080
(verfication_diq080_1 <- sqlQuery(myconn,"
select COUNT(diq080) from mge.DIQ_copy
where diq080 = 1;"))

(verfication_diq080_2 <- sqlQuery(myconn,"
select COUNT(diq080) from mge.DIQ_copy
where diq080 = 2;"))

(verfication_diq080_7 <- sqlQuery(myconn,"
select COUNT(diq080) from mge.DIQ_copy
where diq080 = 7;"))

(verfication_diq080_9 <- sqlQuery(myconn,"
select COUNT(diq080) from mge.DIQ_copy
where diq080 = 9;"))

(verfication_diq080 <- sqlQuery(myconn,"
select COUNT(*) - COUNT(diq080) from mge.DIQ_copy;"))
```

data cleaning

```{r}
#For column DID040, I altered all 666 to 0.5 which means the age is less than 1 year.
update_colDID040 <- sqlQuery(myconn,"update mge.DIQ_copy set did040 = TRY_CONVERT(nvarchar(255),0.5)
where did040 = 666")

result_show <- sqlQuery(myconn, "select did040 FROM mge.DIQ_copy where did040 = '0.5';")

head(result_show, n=10)
```

```{r}
##For column DID040, I use the most of age to esitimate the Missing value, which is 999
##Because there are not much 999 in this column; 
##I did not use mean because I dont want the age be influenced by the exreme data and assume that the prevelance of the disease will only affect the the most of age.
cal_most_age <- sqlQuery(myconn,"
select top 1 with ties did040 from mge.DIQ_copy
where did040 != 'NA'
group by did040 order by count(did040) desc")

fianal_update <- sqlQuery(myconn,"update mge.DIQ_copy set did040 = 50
where did040 = '999';")

result_show <- sqlQuery(myconn, "select did040 FROM mge.DIQ_copy")

head(result_show, n=10)
```

```{r}
## For diq160, I set "Refused" and "dont know" as missing values.
update_diq160 <-  sqlQuery(myconn, "update mge.DIQ_copy set diq160 = NULL
where diq160 = '7';
update mge.DIQ_copy set diq160 = NULL
where diq160 = '9';")

result_show <- sqlQuery(myconn, "select diq160 FROM mge.DIQ_copy")

head(result_show, n=10)
```

```{r}
##For diq170, I set "Refused" and "dont know" as missing values.
update_diq170 <-  sqlQuery(myconn, "update mge.DIQ_copy set diq170 = NULL
where diq170 = '7';
update mge.DIQ_copy set diq170 = NULL
where diq170 = '9';")

result_show <- sqlQuery(myconn, "select diq170 FROM mge.DIQ_copy")

head(result_show, n=10)
```

```{r}
##For diq172, I set "Refused" and "dont know" as missing values.
update_diq172 <-  sqlQuery(myconn, "update mge.DIQ_copy set diq172 = NULL
where diq172 = '7';
update mge.DIQ_copy set diq172 = NULL
where diq172 = '9';")

result_show <- sqlQuery(myconn, "select diq172 FROM mge.DIQ_copy")

head(result_show, n=10)
```


```{r}
##For diq180, I set "Refused" and "dont know" as missing values.
update_diq180 <-  sqlQuery(myconn, "update mge.DIQ_copy set diq180 = NULL
where diq180 = '7';
update mge.DIQ_copy set diq180 = NULL
where diq180 = '9';")

result_show <- sqlQuery(myconn, "select diq180 FROM mge.DIQ_copy")

head(result_show, n=10)
```

```{r}
##For diq050, I set "DON'T KNOW" and "REFUSE" as missing values.
update_diq180 <-  sqlQuery(myconn, "update mge.DIQ_copy set diq050 = NULL
where diq050 = '7';
update mge.DIQ_copy set diq050 = NULL
where diq050 = '9';")

result_show <- sqlQuery(myconn, "select diq180 FROM mge.DIQ_copy")

head(result_show, n=10)
```

```{r}
##For did060, I changed the time units from year to month. 
##So I make 666 around to 0.5 since it is less than 1 month
update_diq060_1 <-  sqlQuery(myconn, "alter table mge.DIQ_copy alter column did060 float
update mge.DIQ_copy set did060 = 0.5
where did060 = '666';")

result_show <- sqlQuery(myconn, "select did060 FROM mge.DIQ_copy where did060 = 0.5")

head(result_show, n=10)
```


```{r}
##Because DIQ060U is the unit of measure (month/year), I remade did060 column and let did060 = did060 * diq060u
##For using the year estimation, I let its value in did060 times 12.
##After I remade the did060 column, I used the mean of unnull values to replace the 999 and 777;
update_diq060_2 <- sqlQuery(myconn, "update mge.DIQ_copy set diq060u = 12
where diq060u = 2;
update mge.DIQ_copy  set did060 = did060 * diq060u
where did060 != 999;
update mge.DIQ_copy set did060 = (
select AVG (did060) from mge.DIQ_copy
where  did060 ! = 999
)
where did060 = 999 or did060 = 777;")

result_show <- sqlQuery(myconn, "select did060 FROM mge.DIQ_copy")

head(result_show, n=10)
```

```{r}
##For diq070, I set "DON'T KNOW" and "REFUSE" as missing values.
update_diq070 <-  sqlQuery(myconn, "update mge.DIQ_copy set diq070 = NULL
where diq070 = '7';
update mge.DIQ_copy set diq070 = NULL
where diq070 = '9';")

result_show <- sqlQuery(myconn, "select diq070 FROM mge.DIQ_copy")

head(result_show, n=10)
```

```{r}
##For diq230, I changed '5' to '0' and changed '9' to 'NULL'
update_diq230 <-  sqlQuery(myconn, "update mge.DIQ_copy set diq230 = NULL
where diq230 = 9;
update mge.DIQ_copy set diq230 = 0
where diq230 = 5;")

result_show <- sqlQuery(myconn, "select diq230 FROM mge.DIQ_copy")

head(result_show, n=10)
```


```{r}
##For further indication, I added a new column to mark the meaning of values in diq230 column 
create_diq230_info <-  sqlQuery(myconn, "ALTER Table mge.DIQ_copy
add diq230_info NVARCHAR(255)")

update_diq230_info <- sqlQuery(myconn, "
update mge.DIQ_copy
set diq230_info = 
(case 
when diq230 = 1 then '1 year ago or less'
when diq230 = 2 then 'More than 1 year ago but no more than 2 years ago'
when diq230 = 3 then 'More than 2 years ago but no more than 5 years ago'
when diq230 = 4 then 'More than 5 years ago'
when diq230 = 0 then 'Never'
else 'unknown'
END
)")

result_show <- sqlQuery(myconn, "select diq230_info FROM mge.DIQ_copy")

head(result_show, n=10)
```


```{r}
##For did250, I change 9999 to 0
## 9999 means that the people dont know the number of times see the doctors past years 
update_did250 <-  sqlQuery(myconn, "update mge.DIQ_copy set did250 = 0
where did250 = 9999")

result_show <- sqlQuery(myconn, "select did250 FROM mge.DIQ_copy where did250 = 0")

head(result_show, n=10)
```

```{r}
##For did260 and diq260u, I connect these two columns to make data more calculatable
##Because diq260u is the units of measure(frequencies in units), while did260 is the the range of the checking years of blood for glucose or sugar
##I standardlised the untis in diq260 and make all of them count in days rather than years, months and weeks.
##I changed did260 values to make it count with day units.
update_diq260u <- sqlQuery(myconn, "
update mge.DIQ_copy set diq260u = 0
where diq260u is NULL;
update mge.DIQ_copy set diq260u = 1/7
where diq260u = 2;
update mge.DIQ_copy set diq260u = 1/30
where diq260u = 3;
update mge.DIQ_copy set diq260u = 1/365
where diq260u = 4;")

update_did260 <- sqlQuery(myconn, "
update mge.DIQ_copy set did260 = TRY_CONVERT(float, did260) * TRY_CONVERT(float,diq260u)
where did260 ! = 999;

update mge.DIQ_copy set did260 = (select AVG (TRY_CONVERT(float, did260)) from mge.DIQ_copy
where  did260 ! = 999)
where did260 = 999;")

result_show <- sqlQuery(myconn, "select did260,diq260u FROM mge.DIQ_copy")

head(result_show, n=10)

```


```{r}
##For diq275, I set "DON'T KNOW" and "REFUSE" as missing values.
update_diq275 <- sqlQuery(myconn, "update mge.DIQ_copy set diq275 = NULL
where diq275 = '7';
update mge.DIQ_copy set diq275 = NULL
where diq275 = '9';")

result_show <- sqlQuery(myconn, "select diq275 FROM mge.DIQ_copy")

head(result_show, n=10)
```


```{r}
##For further indication, I added a new column to mark the meaning of values in diq291 column 
create_diq291_info <-  sqlQuery(myconn, "ALTER Table mge.DIQ_copy
add diq291_info NVARCHAR(255)")

update_diq291_info <-  sqlQuery(myconn, "
update mge.DIQ_copy
set diq291_info = 
(case 
when diq291 = 1 then 'Less than 6'
when diq291 = 2 then 'Less than 7'
when diq291 = 3 then 'Less than 8'
when diq291 = 4 then 'Less than 9'
when diq291 = 5 then 'Less than 10'
when diq291 = 6 then 'Provider did not specify goal'
when diq291 = 77 then 'Refused'
when diq291 = 99 then 'Dont know'
else 'missing'
END
)")

result_show <- sqlQuery(myconn, "select diq291_info FROM mge.DIQ_copy")

head(result_show, n=10)
```

```{r}
## For did350 and diq350u, I did the same thing as did260 and diq260u.  I connected did350 and diq350u to make data more calculatable
## Because diq350u is the units of measure(frequencies in units), while did350 is the the range of the checking feet
## I standardlised the untis in diq260 and make all of them count in days rather than years, months and weeks.
## I also changed did350 values to make it count with day units.

update_did350u <-  sqlQuery(myconn, "
alter table mge.DIQ_copy alter column did350 float;
alter table mge.DIQ_copy alter column diq350u float;
update mge.DIQ_copy set diq350u = 0
where diq350u is NULL;
update mge.DIQ_copy set diq350u = 1/7
where diq350u = 2;
update mge.DIQ_copy set diq350u = 1/30
where diq350u = 3;
update mge.DIQ_copy set diq350u = 1/365
where diq350u = 4;")

update_did350 <-  sqlQuery(myconn, "update mge.DIQ_copy set did350 = TRY_CONVERT(float, did350) * TRY_CONVERT(float, diq350u)
where did350 ! = 9999;
update mge.DIQ_copy set did350 = (select AVG (TRY_CONVERT(float,did350)) from mge.DIQ_copy
where  did350 ! = 9999)
where did350 = 9999;
")

result_show <- sqlQuery(myconn, "select did350,diq350u FROM mge.DIQ_copy")

head(result_show, n=10)
```


```{r}
##For further indication, I added a new column to mark the meaning of values in diq360 column 
create_diq360_info <-  sqlQuery(myconn, "
ALTER Table mge.DIQ_copy
add diq360_info NVARCHAR(255)")

update_diq360_info <- sqlQuery(myconn, "
update mge.DIQ_copy
set diq360_info = 
(case 
when diq360 = 1 then 'Less than 1 month'
when diq360 = 2 then '1-12 months'
when diq360 = 3 then '13-24 months'
when diq360 = 4 then 'Greater than 2 years'
when diq360 = 5 then 'Never'
when diq360 = 7 then 'Refused'
else 'missing'
END
)")

##For diq360, I set "DON'T KNOW" and "REFUSE" as missing values.
update_diq360 <- sqlQuery(myconn, "update mge.DIQ_copy set diq360 = NULL
where diq360 = '7';
update mge.DIQ_copy set diq360 = NULL
where diq360 = '9';")

result_show <- sqlQuery(myconn, "select  diq360_info  FROM mge.DIQ_copy")

head(result_show, n=10)
```

```{r}
##For diq080, I set "DON'T KNOW" and "REFUSE" as missing values.
update_diq080 <- sqlQuery(myconn, "update mge.DIQ_copy set diq080 = NULL
where diq080 = '7';
update mge.DIQ_copy set diq080 = NULL
where diq080 = '9';")

result_show <- sqlQuery(myconn, "select diq080 FROM mge.DIQ_copy")

head(result_show, n=10)
```


```{r}
update_whole_table <- sqlQuery(myconn, "EXEC sp_rename 'mge.DIQ_copy.seqn','seqn_sequence number';
EXEC sp_rename 'mge.DIQ_copy.diq010','diq010_doctor told you have diabetes';
EXEC sp_rename 'mge.DIQ_copy.did040','did040_age when first told you had diabetes';
EXEC sp_rename 'mge.DIQ_copy.diq160','diq160_ever told you have prediabetes';
EXEC sp_rename 'mge.DIQ_copy.diq170','diq170_ever told have health risk for diabetes';
EXEC sp_rename 'mge.DIQ_copy.diq172','diq172_feel could be at risk for diabetes';
EXEC sp_rename 'mge.DIQ_copy.diq175a','diq175a_family history';
EXEC sp_rename 'mge.DIQ_copy.diq175b','diq175b_overweight';
EXEC sp_rename 'mge.DIQ_copy.diq175c','diq175c_Age';
EXEC sp_rename 'mge.DIQ_copy.diq175d','diq175d_poor diet';
EXEC sp_rename 'mge.DIQ_copy.diq175e','diq175e_race';
EXEC sp_rename 'mge.DIQ_copy.diq175f','diq175f_had a baby weighed over 9 lbs. at birth';
EXEC sp_rename 'mge.DIQ_copy.diq175g','diq175g_lack of physical activity';
EXEC sp_rename 'mge.DIQ_copy.diq175h','diq175h_high boold pressure';
EXEC sp_rename 'mge.DIQ_copy.diq175i','diq175i_high boold sugar';
EXEC sp_rename 'mge.DIQ_copy.diq175j','diq175j_high cholesterol';
EXEC sp_rename 'mge.DIQ_copy.diq175k','diq175k_hypoglycemic';
EXEC sp_rename 'mge.DIQ_copy.diq175l','diq175l_extreme hunger';
EXEC sp_rename 'mge.DIQ_copy.diq175m','diq175m_tingling';
EXEC sp_rename 'mge.DIQ_copy.diq175n','diq175n_blurred vision';
EXEC sp_rename 'mge.DIQ_copy.diq175o','diq175o_increased fatigue';
EXEC sp_rename 'mge.DIQ_copy.diq175p','diq175p_anyone could be at risk';
EXEC sp_rename 'mge.DIQ_copy.diq175q','diq175q_doctor warming';
EXEC sp_rename 'mge.DIQ_copy.diq175r','diq175r_other, specify';
EXEC sp_rename 'mge.DIQ_copy.diq175s','diq175s_gestational diabetes';
EXEC sp_rename 'mge.DIQ_copy.diq175t','diq175t_frequent urination ';
EXEC sp_rename 'mge.DIQ_copy.diq175u','diq175u_thirst';
EXEC sp_rename 'mge.DIQ_copy.diq175v','diq175v_craving for sweet/eating a ';
EXEC sp_rename 'mge.DIQ_copy.diq175w','diq175w_medication';
EXEC sp_rename 'mge.DIQ_copy.diq175x','diq175x_polycystic ovarian syndrome';
EXEC sp_rename 'mge.DIQ_copy.diq180','diq180_had blood tested past three years';
EXEC sp_rename 'mge.DIQ_copy.diq050','diq050_taking insulin now';
EXEC sp_rename 'mge.DIQ_copy.did060','did060_how long taking insulin';
EXEC sp_rename 'mge.DIQ_copy.diq060u','diq060u_unit of measure';
EXEC sp_rename 'mge.DIQ_copy.diq070','diq070_take diabetic pills to lower blood sugar';
EXEC sp_rename 'mge.DIQ_copy.diq230','diq230_how long ago saw a diabetes specialist';
EXEC sp_rename 'mge.DIQ_copy.diq240','diq240_is there one dr you see for diabetes';
EXEC sp_rename 'mge.DIQ_copy.did250','did250_past year how many times seen doctor';
EXEC sp_rename 'mge.DIQ_copy.did260','did260_how often check blood for sugar';
EXEC sp_rename 'mge.DIQ_copy.diq260u','diq260u_unit of measure';
EXEC sp_rename 'mge.DIQ_copy.diq275','diq275_past year dr checked for A1C';
EXEC sp_rename 'mge.DIQ_copy.diq280','diq280_what was your last A1C level';
EXEC sp_rename 'mge.DIQ_copy.diq291','diq291_what does dr say A1C should be';
EXEC sp_rename 'mge.DIQ_copy.diq300s','diq300s_what was your recent SBP';
EXEC sp_rename 'mge.DIQ_copy.diq300d','diq300d_what was your recent DBP';
EXEC sp_rename 'mge.DIQ_copy.diq310s','diq310s_what does Dr say SBP should be';
EXEC sp_rename 'mge.DIQ_copy.did310d','did310d_what does Dr say DBP should be';
EXEC sp_rename 'mge.DIQ_copy.did320','did320_what was most recent LDL number';
EXEC sp_rename 'mge.DIQ_copy.did330','did330_what does Dr say LDL should be';
EXEC sp_rename 'mge.DIQ_copy.did341','did341_past year times Dr check feet for sores';
EXEC sp_rename 'mge.DIQ_copy.did350','did350_How often do you check your feet';
EXEC sp_rename 'mge.DIQ_copy.diq350u','diq350u_unit of measure ';
EXEC sp_rename 'mge.DIQ_copy.diq360','diq360_last time had pupils dilated for exam';
EXEC sp_rename 'mge.DIQ_copy.diq080','diq080_diabetes affected eyes';
EXEC sp_rename 'mge.DIQ_copy.diq360_info','diq360_info_last time had pupils dilated for exam';
EXEC sp_rename 'mge.DIQ_copy.diq230_info','diq230_info_how long ago saw a diabetes specialist';
EXEC sp_rename 'mge.DIQ_copy.diq291_info','diq291_infowhat does dr say A1C should be';
")

result_show <- sqlQuery(myconn, "select * FROM mge.DIQ_copy")

head(result_show, n=10)
```




