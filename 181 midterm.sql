SELECT * FROM [mge].DIQ_copy



select * into mge.DIQ_copy from mge.DIQ_I_version1;

alter table mge.DIQ_copy
alter column did040 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq160 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq170 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq172 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175a NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175b NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175c NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175d NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175e NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175f NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175g NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175h NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175i NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175j NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175k NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175l NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175m NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175n NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175O NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175p NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175q NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175r NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175s NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175t NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175u NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175v NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175w NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq175x NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq180 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq050 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column did060 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq060u NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq070 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq230 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq240 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column did250 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column DID260 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq260u NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq275 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq280 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq291 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq300s NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq300d NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column did310s NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column did310d NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column did320 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column did330 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column did341 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column did350 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq350u NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq360 NVARCHAR(50) NULL;
alter table mge.DIQ_copy
alter column diq080 NVARCHAR(50) NULL;

update mge.DIQ_copy set did040 = NULL
where did040 = 'NA'
update mge.DIQ_copy set diq160 = NULL
where diq160 = 'NA'
update mge.DIQ_copy set diq170 = NULL
where diq170 = 'NA'
update mge.DIQ_copy set diq172 = NULL
where diq172 = 'NA'
update mge.DIQ_copy set diq175a = NULL
where diq175a = 'NA'
update mge.DIQ_copy set diq175b = NULL
where diq175b = 'NA'

update mge.DIQ_copy set diq175c = NULL
where diq175c = 'NA'

update mge.DIQ_copy set diq175d = NULL
where diq175d = 'NA'

update mge.DIQ_copy set diq175e = NULL
where diq175e = 'NA'

update mge.DIQ_copy set diq175f = NULL
where diq175f = 'NA'

update mge.DIQ_copy set diq175g = NULL
where diq175g = 'NA'

update mge.DIQ_copy set diq175h = NULL
where diq175h = 'NA'

update mge.DIQ_copy set diq175i = NULL
where diq175i = 'NA'

update mge.DIQ_copy set diq175j = NULL
where diq175j = 'NA'

update mge.DIQ_copy set diq175k = NULL
where diq175k = 'NA'

update mge.DIQ_copy set diq175l = NULL
where diq175l = 'NA'

update mge.DIQ_copy set diq175m = NULL
where diq175m = 'NA'

update mge.DIQ_copy set diq175n = NULL
where diq175n = 'NA'

update mge.DIQ_copy set diq175o = NULL
where diq175o = 'NA'

update mge.DIQ_copy set diq175p = NULL
where diq175p = 'NA'

update mge.DIQ_copy set diq175q = NULL
where diq175q = 'NA'

update mge.DIQ_copy set diq175r = NULL
where diq175r = 'NA'

update mge.DIQ_copy set diq175s = NULL
where diq175s = 'NA'

update mge.DIQ_copy set diq175t = NULL
where diq175t = 'NA'

update mge.DIQ_copy set diq175u = NULL
where diq175u = 'NA'

update mge.DIQ_copy set diq175v = NULL
where diq175v = 'NA'

update mge.DIQ_copy set diq175w = NULL
where diq175w = 'NA'

update mge.DIQ_copy set diq175x = NULL
where diq175x = 'NA'

update mge.DIQ_copy set diq180 = NULL
where diq180 = 'NA'

update mge.DIQ_copy set diq050 = NULL
where diq050 = 'NA'

update mge.DIQ_copy set did060 = NULL
where did060  = 'NA'

update mge.DIQ_copy set diq060u = NULL
where diq060u = 'NA'

update mge.DIQ_copy set diq070 = NULL
where diq070 = 'NA'

update mge.DIQ_copy set diq230 = NULL
where diq230 = 'NA'

update mge.DIQ_copy set diq240 = NULL
where diq240 = 'NA'

update mge.DIQ_copy set did250 = NULL
where did250 = 'NA'

update mge.DIQ_copy set did260 = NULL
where did260 = 'NA'

update mge.DIQ_copy set diq260u = NULL
where diq260u = 'NA'

update mge.DIQ_copy set diq275 = NULL
where diq275 = 'NA'

update mge.DIQ_copy set diq280 = NULL
where diq280 = 'NA'

update mge.DIQ_copy set diq291 = NULL
where diq291 = 'NA'

update mge.DIQ_copy set diq300s = NULL
where diq300s = 'NA'

update mge.DIQ_copy set diq300d = NULL
where diq300d = 'NA'

update mge.DIQ_copy set did310s = NULL
where did310s = 'NA'

update mge.DIQ_copy set did310d = NULL
where did310d = 'NA'

update mge.DIQ_copy set did320 = NULL
where did320 = 'NA'

update mge.DIQ_copy set did330 = NULL
where did330 = 'NA'

update mge.DIQ_copy set did341 = NULL
where did341 = 'NA'

update mge.DIQ_copy set did350 = NULL
where did350 = 'NA'

update mge.DIQ_copy set diq350u = NULL
where diq350u  = 'NA'

update mge.DIQ_copy set diq360 = NULL
where diq360 = 'NA'

update mge.DIQ_copy set diq080 = NULL
where diq080 = 'NA'


-- Verify the counts of each code or value for various variables

select COUNT(diq010) from mge.DIQ_copy
where diq010 = '1'

select COUNT(diq010) from mge.DIQ_copy
where diq010 = '2'

select COUNT(diq010) from mge.DIQ_copy
where diq010 = '3'

select COUNT(diq010) from mge.DIQ_copy
where diq010 = '7'

select COUNT(diq010) from mge.DIQ_copy
where diq010 = '9'

select COUNT(*)-COUNT(diq010) from mge.DIQ_copy

select COUNT(did040) from mge.DIQ_copy
where did040 between '2' and '78'

select COUNT(did040) from mge.DIQ_copy
where did040 = '80'

select COUNT(did040) from mge.DIQ_copy
where did040 = '666'

select COUNT(did040) from mge.DIQ_copy
where did040 = '777'

select COUNT(did040) from mge.DIQ_copy
where did040 = '999'

select COUNT(*)-COUNT(did040) from mge.DIQ_copy

select COUNT(diq160) from mge.DIQ_copy
where diq160 = '1'

select COUNT(diq160) from mge.DIQ_copy
where diq160 = '2'

select COUNT(diq160) from mge.DIQ_copy
where diq160 = '7'

select COUNT(diq160) from mge.DIQ_copy
where diq160 = '9'

select COUNT(*)-COUNT(diq160) from mge.DIQ_copy



select COUNT(diq170) from mge.DIQ_copy
where diq170 = '1'

select COUNT(diq170) from mge.DIQ_copy
where diq170 = '2'

select COUNT(diq170) from mge.DIQ_copy
where diq170 = '7'

select COUNT(diq170) from mge.DIQ_copy
where diq170 = '9'

select COUNT(*)-COUNT(diq170) from mge.DIQ_copy



select COUNT(diq172) from mge.DIQ_copy
where diq172 = '1'

select COUNT(diq172) from mge.DIQ_copy
where diq172 = '2'

select COUNT(diq172) from mge.DIQ_copy
where diq172 = '7'

select COUNT(diq172) from mge.DIQ_copy
where diq172 = '9'

select COUNT(*)-COUNT(diq172) from mge.DIQ_copy


select COUNT(diq175a) from mge.DIQ_copy
where diq175a = '10'

select COUNT(diq175a) from mge.DIQ_copy
where diq175a = '77'

select COUNT(diq175a) from mge.DIQ_copy
where diq175a = '99'

select COUNT(*)-COUNT(diq175a) from mge.DIQ_copy


select COUNT(diq175b) from mge.DIQ_copy
where diq175b = '11'
select COUNT(*)-COUNT(diq175b) from mge.DIQ_copy

select COUNT(diq175c) from mge.DIQ_copy
where diq175c = '12'
select COUNT(*)-COUNT(diq175c) from mge.DIQ_copy

select COUNT(diq175d) from mge.DIQ_copy
where diq175d = '13'
select COUNT(*)-COUNT(diq175d) from mge.DIQ_copy

select COUNT(diq175e) from mge.DIQ_copy
where diq175e = '14'
select COUNT(*)-COUNT(diq175e) from mge.DIQ_copy

select COUNT(diq175f) from mge.DIQ_copy
where diq175f = '15'
select COUNT(*)-COUNT(diq175f) from mge.DIQ_copy

select COUNT(diq175g) from mge.DIQ_copy
where diq175g = '16'
select COUNT(*)-COUNT(diq175g) from mge.DIQ_copy

select COUNT(diq175h) from mge.DIQ_copy
where diq175h = '17'
select COUNT(*)-COUNT(diq175h) from mge.DIQ_copy

select COUNT(diq175i) from mge.DIQ_copy
where diq175i = '18'
select COUNT(*)-COUNT(diq175i) from mge.DIQ_copy

select COUNT(diq175j) from mge.DIQ_copy
where diq175j = '19'
select COUNT(*)-COUNT(diq175j) from mge.DIQ_copy

select COUNT(diq175k) from mge.DIQ_copy
where diq175k = '20'
select COUNT(*)-COUNT(diq175k) from mge.DIQ_copy

select COUNT(diq175l) from mge.DIQ_copy
where diq175l = '21'
select COUNT(*)-COUNT(diq175l) from mge.DIQ_copy

select COUNT(diq175m) from mge.DIQ_copy
where diq175m = '22'
select COUNT(*)-COUNT(diq175m) from mge.DIQ_copy

select COUNT(diq175n) from mge.DIQ_copy
where diq175n = '23'
select COUNT(*)-COUNT(diq175n) from mge.DIQ_copy

select COUNT(diq175o) from mge.DIQ_copy
where diq175o = '24'
select COUNT(*)-COUNT(diq175O) from mge.DIQ_copy

select COUNT(diq175p) from mge.DIQ_copy
where diq175p = '25'
select COUNT(*)-COUNT(diq175p) from mge.DIQ_copy

select COUNT(diq175q) from mge.DIQ_copy
where diq175q = '26'
select COUNT(*)-COUNT(diq175q) from mge.DIQ_copy

select COUNT(diq175r) from mge.DIQ_copy
where diq175r = '27'
select COUNT(*)-COUNT(diq175r) from mge.DIQ_copy

select COUNT(diq175s) from mge.DIQ_copy
where diq175s = '28'
select COUNT(*)-COUNT(diq175s) from mge.DIQ_copy

select COUNT(diq175t) from mge.DIQ_copy
where diq175t = '29'
select COUNT(*)-COUNT(diq175t) from mge.DIQ_copy

select COUNT(diq175u) from mge.DIQ_copy
where diq175u = '30'
select COUNT(*)-COUNT(diq175u) from mge.DIQ_copy

select COUNT(diq175v) from mge.DIQ_copy
where diq175v = '31'
select COUNT(*)-COUNT(diq175v) from mge.DIQ_copy

select COUNT(diq175w) from mge.DIQ_copy
where diq175w = '32'
select COUNT(*)-COUNT(diq175w) from mge.DIQ_copy

select COUNT(diq175x) from mge.DIQ_copy
where diq175x = '33'
select COUNT(*)-COUNT(diq175x) from mge.DIQ_copy


select COUNT(diq180) from mge.DIQ_copy
where diq180 = '1'

select COUNT(diq180) from mge.DIQ_copy
where diq180 = '2'

select COUNT(diq180) from mge.DIQ_copy
where diq180 = '7'

select COUNT(diq180) from mge.DIQ_copy
where diq180 = '9'

select COUNT(*)-COUNT(diq180) from mge.DIQ_copy

select COUNT(diq050) from mge.DIQ_copy
where diq050 = '1'

select COUNT(diq050) from mge.DIQ_copy
where diq050 = '2'

select COUNT(diq050) from mge.DIQ_copy
where diq050 = '7'

select COUNT(diq050) from mge.DIQ_copy
where diq050 = '9'

select COUNT(*)-COUNT(diq050) from mge.DIQ_copy

select COUNT(did060) from mge.DIQ_copy
where did060 between '1' and '55'

select COUNT(did060) from mge.DIQ_copy
where did060 = '666'

select COUNT(did060) from mge.DIQ_copy
where did060 = '777'

select COUNT(did060) from mge.DIQ_copy
where did060 = '999'

select COUNT(*)-COUNT(did060) from mge.DIQ_copy

select COUNT(diq060u) from mge.DIQ_copy
where diq060u = '1'

select COUNT(diq060u) from mge.DIQ_copy
where diq060u = '2'

select COUNT(*)-COUNT(diq060u) from mge.DIQ_copy


select COUNT(diq070) from mge.DIQ_copy
where diq070 = '1'

select COUNT(diq070) from mge.DIQ_copy
where diq070 = '2'

select COUNT(diq070) from mge.DIQ_copy
where diq070 = '7'

select COUNT(diq070) from mge.DIQ_copy
where diq070 = '9'

select COUNT(*)-COUNT(diq070) from mge.DIQ_copy

select COUNT(diq230) from mge.DIQ_copy
where diq230 = '1'

select COUNT(diq230) from mge.DIQ_copy
where diq230 = '2'

select COUNT(diq230) from mge.DIQ_copy
where diq230 = '3'

select COUNT(diq230) from mge.DIQ_copy
where diq230 = '4'

select COUNT(diq230) from mge.DIQ_copy
where diq230 = '5'

select COUNT(diq230) from mge.DIQ_copy
where diq230 = '7'

select COUNT(diq230) from mge.DIQ_copy
where diq230 = '9'

select COUNT(*)-COUNT(diq230) from mge.DIQ_copy

select COUNT(diq050) from mge.DIQ_copy
where diq050 = 1 
select COUNT(diq050) from mge.DIQ_copy
where diq050 = 2
select COUNT(diq050) from mge.DIQ_copy
where diq050 = 7 
select COUNT(diq050) from mge.DIQ_copy
where diq050 = 9 
select COUNT(*)-count(diq050) from mge.DIQ_copy

select COUNT(diq230) from mge.DIQ_copy
where diq230 = 1 
select COUNT(diq230) from mge.DIQ_copy
where diq230 = 2
select COUNT(diq230) from mge.DIQ_copy
where diq230 = 3 
select COUNT(diq230) from mge.DIQ_copy
where diq230 = 4 
select COUNT(diq230) from mge.DIQ_copy
where diq230 = 5 
select COUNT(diq230) from mge.DIQ_copy
where diq230 = 7 
select COUNT(diq230) from mge.DIQ_copy
where diq230 = 9 
select COUNT(*) - COUNT(diq230) from mge.DIQ_copy

select COUNT(diq291) from mge.DIQ_copy
where diq291 = 1 
select COUNT(diq291) from mge.DIQ_copy
where diq291 = 2
select COUNT(diq291) from mge.DIQ_copy
where diq291 = 3 
select COUNT(diq291) from mge.DIQ_copy
where diq291 = 4
select COUNT(diq291) from mge.DIQ_copy
where diq291 = 5
select COUNT(diq291) from mge.DIQ_copy
where diq291 = 6
select COUNT(diq291) from mge.DIQ_copy
where diq291 = 77
select COUNT(diq291) from mge.DIQ_copy
where diq291 = 99
select COUNT(*) - COUNT(diq291) from mge.DIQ_copy

select COUNT(diq360) from mge.DIQ_copy
where diq360= 1 
select COUNT(diq360) from mge.DIQ_copy
where diq360= 2
select COUNT(diq360) from mge.DIQ_copy
where diq360= 3 
select COUNT(diq360) from mge.DIQ_copy
where diq360= 4
select COUNT(diq360) from mge.DIQ_copy
where diq360= 5
select COUNT(diq360) from mge.DIQ_copy
where diq360= 7
select COUNT(diq360) from mge.DIQ_copy
where diq360= 9
select COUNT(*) - COUNT(diq360) from mge.DIQ_copy

select COUNT(diq080) from mge.DIQ_copy
where diq080 = 1 
select COUNT(diq080) from mge.DIQ_copy
where diq080 = 2
select COUNT(diq080) from mge.DIQ_copy
where diq080 = 7 
select COUNT(diq080) from mge.DIQ_copy
where diq080 = 9 
select COUNT(*) - COUNT(diq080) from mge.DIQ_copy


--data cleaning

--For column DID040, I altered all 666 to 0.5 which means the age is less than 1 year.
update mge.DIQ_copy set [DID040] = 0.5
where [DID040] = 666


--For column DID040, I use the most of age to esitimate the Missing value, which is 999
--Because there are not much 999 in this column; 
--I did not use mean because I dont want the age be influenced by the exreme data and assume that the prevelance of the disease will only affect the the most of age.
select top 1 with ties did040 from mge.DIQ_copy
where did040 != 'NA'
group by did040 order by count(did040) desc

update mge.DIQ_copy set did040 = 50
where did040 = '999'

SELECT * FROM mge.DIQ_copy

--For diq160, I set "Refused" and "dont know" as missing values.
update mge.DIQ_copy set diq160 = NULL
where diq160 = '7';
update mge.DIQ_copy set diq160 = NULL
where diq160 = '9';

--For diq170, I set "Refused" and "dont know" as missing values.
update mge.DIQ_copy set diq170 = NULL
where diq170 = '7';
update mge.DIQ_copy set diq170 = NULL
where diq170 = '9';

--For diq172, I set "Refused" and "dont know" as missing values.
update mge.DIQ_copy set diq172 = NULL
where diq172 = '7';
update mge.DIQ_copy set diq172 = NULL
where diq172 = '9';

--For diq180, I set "Refused" and "dont know" as missing values.
update mge.DIQ_copy set diq180 = NULL
where diq180 = '7';
update mge.DIQ_copy set diq180 = NULL
where diq180 = '9';

--For diq050, I set "DON'T KNOW" and "REFUSE" as missing values.
update mge.DIQ_copy set diq050 = NULL
where diq050 = '7';
update mge.DIQ_copy set diq050 = NULL
where diq050 = '9';

--For did060, I changed the time units from year to month. 
--So I make 666 around to 0.5 since it is less than 1 month
alter table mge.DIQ_copy alter column did060 float
update mge.DIQ_copy set did060 = 0.5
where did060 = '666';


--Because DIQ060U is the unit of measure (month/year), I remade did060 column and let did060 = did060 * diq060u
--For using the year estimation, I let its value in did060 times 12.
--After I remade the did060 column, I used the mean of unnull values to replace the 999 and 777;
update mge.DIQ_copy set diq060u = 12
where diq060u = 2;
update mge.DIQ_copy  set did060 = did060 * diq060u
where did060 != 999;
update mge.DIQ_copy set did060 = (
select AVG (did060) from mge.DIQ_copy
where  did060 ! = 999
)
where did060 = 999 or did060 = 777;

--For diq070, I set "DON'T KNOW" and "REFUSE" as missing values.
update mge.DIQ_copy set diq070 = NULL
where diq070 = '7';
update mge.DIQ_copy set diq070 = NULL
where diq070 = '9';


--For diq230, I changed '5' to '0' and changed '9' to 'NULL'
update mge.DIQ_copy set diq230 = NULL
where diq230 = 9;
update mge.DIQ_copy set diq230 = 0
where diq230 = 5;

--For further indication, I added a new column to mark the meaning of values in diq230 column 
ALTER Table mge.DIQ_copy
add diq230_info NVARCHAR(255)

update mge.DIQ_copy
set diq230_info = 
(case 
when diq230 = 1 then '1 year ago or less'
when diq230 = 2 then 'More than 1 year ago but no more than 2 years ago'
when diq230 = 3 then 'More than 2 years ago but no more than 5 years ago'
when diq230 = 4 then 'More than 5 years ago'
when diq230 = 0 then 'Never'
else NULL
END
)


--For did250, I change 9999 to 0
-- 9999 means that the people dont know the number of times see the doctors past years 
update mge.DIQ_copy set did250 = 0
where did250 = 9999


--For did260 and diq260u, I connect these two columns to make data more calculatable
--Because diq260u is the units of measure(frequencies in units), while did260 is the the range of the checking years of blood for glucose or sugar
--I standardlised the untis in diq260 and make all of them count in days rather than years, months and weeks.
--I changed did260 values to make it count with day units.

update mge.DIQ_copy set diq260u = 0
where diq260u is NULL;
update mge.DIQ_copy set diq260u = 1/7
where diq260u = 2;
update mge.DIQ_copy set diq260u = 1/30
where diq260u = 3;
update mge.DIQ_copy set diq260u = 1/365
where diq260u = 4;

update mge.DIQ_copy set did260 = TRY_CONVERT(float, did260) * TRY_CONVERT(float,diq260u)
where did260 ! = 999;

update mge.DIQ_copy set did260 = (select AVG (TRY_CONVERT(float, did260)) from mge.DIQ_copy
where  did260 ! = 999)
where did260 = 999;


--For diq275, I set "DON'T KNOW" and "REFUSE" as missing values.
update mge.DIQ_copy set diq275 = NULL
where diq275 = '7';
update mge.DIQ_copy set diq275 = NULL
where diq275 = '9';


--For further indication, I added a new column to mark the meaning of values in diq291 column 
ALTER Table mge.DIQ_copy
add diq291_info NVARCHAR(255)

update mge.DIQ_copy
set diq291_info = 
(case 
when diq291 = 1 then 'Less than 6'
when diq291 = 2 then 'Less than 7'
when diq291 = 3 then 'Less than 8'
when diq291 = 4 then 'Less than 9'
when diq291 = 5 then 'Less than 10'
when diq291 = 6 then 'Provider did not specify goal'
when diq291 = 77 then 'Refused'
when diq291 = 99 then 'Dont know'
else NULL
END
)



--For did350 and diq350u, I did the same thing as did260 and diq260u.  I connected did350 and diq350u to make data more calculatable
--Because diq350u is the units of measure(frequencies in units), while did350 is the the range of the checking feet
--I standardlised the untis in diq260 and make all of them count in days rather than years, months and weeks.
--I also changed did350 values to make it count with day units.

alter table mge.DIQ_copy alter column did350 float;
alter table mge.DIQ_copy alter column diq350u float;
update mge.DIQ_copy set diq350u = 0
where diq350u is NULL;
update mge.DIQ_copy set diq350u = 1/7
where diq350u = 2;
update mge.DIQ_copy set diq350u = 1/30
where diq350u = 3;
update mge.DIQ_copy set diq350u = 1/365
where diq350u = 4;
update mge.DIQ_copy set did350 = TRY_CONVERT(float, did350) * TRY_CONVERT(float, diq350u)
where did350 ! = 9999;


update mge.DIQ_copy set did350 = (select AVG (TRY_CONVERT(float,did350)) from mge.DIQ_copy
where  did350 ! = 9999)
where did350 = 9999;


--For further indication, I added a new column to mark the meaning of values in diq360 column 
ALTER Table mge.DIQ_copy
add diq360_info NVARCHAR(255)

update mge.DIQ_copy
set diq360_info = 
(case 
when diq360 = 1 then 'Less than 1 month'
when diq360 = 2 then '1-12 months'
when diq360 = 3 then '13-24 months'
when diq360 = 4 then 'Greater than 2 years'
when diq360 = 5 then 'Never'
when diq360 = 7 then 'Refused'
else NULL
END
)

--For diq360, I set "DON'T KNOW" and "REFUSE" as missing values.
update mge.DIQ_copy set diq360 = NULL
where diq360 = '7';
update mge.DIQ_copy set diq360 = NULL
where diq360 = '9';


--For diq080, I set "DON'T KNOW" and "REFUSE" as missing values.
update mge.DIQ_copy set diq080 = NULL
where diq080 = '7';
update mge.DIQ_copy set diq080 = NULL
where diq080 = '9';

